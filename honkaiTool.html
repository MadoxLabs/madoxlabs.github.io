
<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <title>Madox Labs - Honkai Impact Tool</title>

  <style>
    table.blueTable {
      border: 1px solid #1C6EA4;
      background-color: #EEEEEE;
      width: 100%;
      text-align: left;
      border-collapse: collapse;
    }

      table.blueTable td, table.blueTable th {
        border: 1px solid #AAAAAA;
        padding: 3px 2px;
      }

      table.blueTable tbody td {
        font-size: 13px;
      }

      table.blueTable tr:nth-child(even) {
        background: #D0E4F5;
      }

      table.blueTable thead {
        background: #1C6EA4;
        background: -moz-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        background: -webkit-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        background: linear-gradient(to bottom, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        border-bottom: 2px solid #444444;
      }

        table.blueTable thead th {
          font-size: 15px;
          font-weight: bold;
          color: #FFFFFF;
          border-left: 2px solid #D0E4F5;
        }

          table.blueTable thead th:first-child {
            border-left: none;
          }

      table.blueTable tfoot td {
        font-size: 14px;
      }

      table.blueTable tfoot .links {
        text-align: right;
      }

        table.blueTable tfoot .links a {
          display: inline-block;
          background: #1C6EA4;
          color: #FFFFFF;
          padding: 2px 8px;
          border-radius: 5px;
        }
  </style>

  <script type="text/javascript">

    var dataValks = [
      "Battle Storm:[Himeko,BIO,aoe,fire,float,charge,weaken atk,(leader)reduce dmg,(paralyze)QTE]",
      "Kreigsmesser:[Himeko,PSY,aoe,ice,slow,charge,knockdown,immune,(leader)[reduce dmg,incr atk],(ignite)QTE]",
      "Herrscher Of The Void:[]",
      "Shadow Dash:[]",
      "Valkyrie Ranger:[]",
      "Sundenjager:[]",
      "Valkyrie Chariot:[]",
      "Dimension Breaker:[]",
      "Night Squire:[]",
      "White Comet:[]",
      "Ritual Imayoh:[]",
      "Divine Prayer:[]",
      "Crimson Impulse:[]",
      "Gyakushinn Miko:[]",
      "Valkyrie Triumph:[]",
      "Scarlet Fusion:[]",
      "Valkyrie Pledge:[]",
      "Luna Kindred:[]"
    ];

    var Valks = [
    ];

    function obj(elem)
    {
      // walk up parents until we fuind an obj
      let e = elem;
      while (e)
      {
        if (e.obj) return e.obj;
        e = e.parentElement;
      }
      return null;
    }

    class ValkUI
    {
      constructor(id)
      {
        this.id = id;

        this.lastHilite = -1;
        this.divMode = "valkMode" + id;
        this.divSelect = "valkSelect" + id;
        this.elemSearch = "valkSearch" + id;
        this.elemResult = id + "valk";
        this.elemProp = id + "prop";

        document.getElementById(this.divMode).obj = this;
      }

      reset()
      {
        document.getElementById(this.divMode).innerHTML = "Select Valkyrie: <input onmouseover='this.focus()' onmouseout='this.blur()' type=\"text\" id=\"" + this.elemSearch + "\" onchange=\"obj(this).search();\" onkeypress=\"this.onchange();\" onpaste=\"this.onchange();\" oninput=\"this.onchange();\" /><div id=\"" + this.divSelect + "\"></div>";
        this.lastHilite = -1;
      }

      search()
      {
        let query = document.getElementById(this.elemSearch).value.toLowerCase();
        let buf = "";
        if (query.length > 0)
        {
          for (let i in Valks)
          {
            if (Valks[i].name.toLowerCase().indexOf(query) != -1)
            {
              buf += "<div id='" + this.elemResult + i + "' onmouseover='obj(this).hilite(" + i + ")' onclick='obj(this).pick(" + i + ")'>" + Valks[i].name + "</div>";
            }
          }
        }
        document.getElementById(this.divSelect).innerHTML = buf;
      }
 
      hilite(index)
      {
        if (this.lastHilite > -1)
        {
          let item = document.getElementById(this.elemResult + this.lastHilite);
          item.style.border = "";
        }
        this.lastHilite = index;
        let item = document.getElementById(this.elemResult + index);
        item.style.border = "2px solid green";
      }
  
      outline(index)
      {
        if (this.lastHilite > -1)
        {
          let item = document.getElementById(this.elemProp + this.lastHilite);
          item.style.border = "";
        }
        this.lastHilite = index;
        let item = document.getElementById(this.elemProp + index);
        item.style.border = "2px solid black";
      }   

      pick(index)
      {
        let buf = "Name: " + Valks[index].name + "<br><br>";
        for (let i in Valks[index].props)
        {
          if (Valks[index].props[i].if)
          {

          }
          else
            buf += "<div id='" + this.elemProp + i + "' onmouseout='obj(this).outline(" + i + ")' onmouseover='obj(this).outline(" + i + ")'>" + Valks[index].props[i] + "</div>";
        }
        buf += "<br><button onclick='obj(this).reset()'>Reset</button>";

        document.getElementById(this.divMode).innerHTML = buf;
      }
    }

    class App
    {
      Valk = [];
      constructor()
      {
        this.Valk[0] = new ValkUI(0);
        this.Valk[1] = new ValkUI(1);
        this.Valk[2] = new ValkUI(2);
      }

      reset()
      {
        for (let i in this.Valk) this.Valk[i].reset();
      }
    }

    var app = null;

    function init()
    {
      app = new App();
      app.reset();
      for (let i in dataValks)
      {
        Valks.push(parseObject(dataValks[i]));
      }
    }

    function parseObject(data)
    {
      // data := key ":" props
      // props := "[" item ("," item) "]"
      // item := (if) props
      // if := "(" key ")"

      // get the name
      let loc = data.indexOf(':');
      if (loc == -1) return null;
      let name = data.substr(0, loc);
      let props = data.substr(loc + 1);
      // make item
      let item = { name: name, props: parseProps(props) };
      return item;
    }

    function parseProps(data)
    {
      let ret = [];
      do
      {
        // start with [, end with ]
        if (data[0] != '[') break;
        if (data[data.length - 1] != ']') break;
        // split into seperate terms
        let inside = 0;
        let start = 1;
        for (let x = start; x < data.length-1; ++x)
        {
          switch (data[x])
          {
            case '[': inside++; break;
            case ']': inside--; break;
            case ',': if (!inside) { ret.push(parseItem(data.substr(start, x - start))); start = x + 1; break; }
          }
        }
        if (start < data.length-1) ret.push(parseItem(data.substr(start, data.length-start-1)));
      } while (false);
      return ret;
    }

    function parseItem(data)
    {
      // check for if
      if (data[0] == '(')
      {

        let loc = data.indexOf(')');
        let ifkey = data.substr(1, loc - 1);
        if (data[loc+1] == '[')
          return { if: ifkey, props: parseProps(data.substr(loc + 1)) };
        else
          return { if: ifkey, props: parseItem(data.substr(loc + 1)) };
      }
      // its just a key
      else
      {
        return data;
      }
    }
  </script>
</head>

<body onload="init();">
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 1</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode0"></div>
        </td>
        <td valign="top"><div><b>Weapon</b></div></td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>
  <br />
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 2</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode1"></div>
        </td>
        <td valign="top"><div><b>Weapon</b></div></td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>
  <br />
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 3</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode2"></div>
        </td>
        <td valign="top"><div><b>Weapon</b></div></td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>

</body>
</html>
