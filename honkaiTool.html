
<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <title>Madox Labs - Honkai Impact Tool</title>

  <style>
    body {
      margin: 0px;
    }

    div.my-tooltip {
      background: rgba(40,40,40,0.8);
      display: inline-block;
      border-radius: 4px;
      color: white;
      box-shadow: 1px 1px 3px #aaa;
      padding: 5px 10px;
      margin: 5px 10px;
      line-height: 100%;
      font-size: 15px;
    }

    div.my-tooltip.left-top:before {
      content: "";
      position: absolute;
      width: 0;
      height: 0;
      border-top: 5px solid transparent;
      border-right: 5px solid rgba(40,40,40,0.8);
      border-bottom: 5px solid transparent;
      margin: 1px 0 0 -15px;
    }

    div.header {
      background-color: #000000;
      color: #ffffff;
      position: absolute;
      top: -80px;
      left: 10px;
      font-weight: bold;
      font-size: 2em;
    }

    div.unmet {
      background-color: #aa0000;
      color: #ffffff;
    }

    div.met {
      background-color: #00aa00;
      color: #ffffff;
    }

    div.menu {
      background-color: #000000;
      color: #ffffff;
      position: absolute;
      top: 0px;
      left: 210px;
      width: 100%;
      height: 128px;
      padding: 0px 0px;
      margin: 0px;
    }

    table.blueTable {
      border: 1px solid #1C6EA4;
      background-color: #EEEEEE;
      width: 100%;
      text-align: left;
      border-collapse: collapse;
      margin: 8px;
    }

    table.blueTable td, table.blueTable th {
      border: 1px solid #AAAAAA;
      padding: 3px 2px;
    }

    table.blueTable tbody td {
      font-size: 13px;
    }

    table.blueTable tr:nth-child(even) {
      background: #D0E4F5;
    }

    table.blueTable thead {
      background: #1C6EA4;
      background: -moz-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
      background: -webkit-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
      background: linear-gradient(to bottom, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
      border-bottom: 2px solid #444444;
    }

    table.blueTable thead th {
      font-size: 15px;
      font-weight: bold;
      color: #FFFFFF;
      border-left: 2px solid #D0E4F5;
    }

    table.blueTable thead th:first-child {
      border-left: none;
    }

    table.blueTable tfoot td {
      font-size: 14px;
    }

    table.blueTable tfoot .links {
      text-align: right;
    }

    table.blueTable tfoot .links a {
      display: inline-block;
      background: #1C6EA4;
      color: #FFFFFF;
      padding: 2px 8px;
      border-radius: 5px;
    }

    .slider {
      -webkit-appearance: none;
      height: 15px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

    .slider:hover {
      opacity: 1;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 15px;
      height: 15px;
      background: #4CAF50;
      cursor: pointer;
    }

    .slider::-moz-range-thumb {
      width: 15px;
      height: 15px;
      background: #4CAF50;
      cursor: pointer;
    }
  </style>

  <script type="text/javascript">

    /*
    BATTLE STORM
    B aoe knockdown (paralyze)[QTE, knockback] (crit)[fire] gather float fire charge weaken fracture slow
    S stun
    SS ignite
    SSS stun

    KRIEGSMESSER
    A charge ice slow aoe knockdown (ignite)[QTE ice freeze] freeze
    S ice
    SSS slow

    SCARLET FUSION
    A charge float lightning paralyze
    S (fracture)[QTE float lightning paralyze AOE] paralyze AOE (ignite) (bleed)
    SS bleed
    SSS paralyze

    VALKYRIE TRIUMPH
    A fracture aoe charge stun (frozen) (stun) (leader)[BIO]
    S (frozen)[QTE] heal

    Valkyrie Ranger
    A pierce (crit) stun bleed (freeze)[QTE aoe] gather (break)[stun]
    S fire (MECH)
    SS crit (freeze)
    */

    var dataValks = [
      "Battle Storm:[(B)[Himeko,BIO,aoe,knockdown,(paralyze)[QTE,knockback],(crit)[],gather,float,fire,charge,weaken,fracture,slow],(S)stun,(SS)ignite]",
      "Kreigsmesser:[(A)[Himeko,PSY,charge,ice,slow,aoe,knockdown,(ignite)[QTE],freeze],(SSS)slow]",
      "Scarlet Fusion:[(A)[Himeko,MECH,charge,float,lightning,paralyze],(S)[(fracture)[QTE],aoe,(ignite)[],(bleed)[]],(SS)bleed]",
      "Valkyrie Triumph:[(A)[Himeko,BIO,fracture,aoe,charge,stun,(freeze),(stun),(leader)[BIO]],(S)[(freeze)[QTE],heal]]",
      "Herrscher Of The Void:[]",
      "White Comet:[]",
      "Valkyrie Ranger:[]",
      "Divine Prayer:[]",
      "Shadow Dash:[(B)[Mei,MECH]]",
      "Crimson Impulse:[]",
      "Valkyrie Chariot:[]",
      "Dimension Breaker:[]",
      "Yamabuki Armor:[]",
      "Snowy Sniper:[]",
      "Wolf's Dawn:[]",
      "Valkyrie Pledge:[]",
      "Luna Kindred:[]",
      "Night Squire:[]",
      "Umbral Rose:[]",
      "Gyakushinn Miko:[]",
      "Flame Sakitama:[]",
      "Sundenjager:[]",
      "Ritual Imayoh:[]"
    ];

    var dataWeapons = [
      "Galactic Nova:[(Mei)[sparkling star,aoe]]",
      "Jizo Mitama:[(Mei)[summon,float,(float)incr dmg,(coop)incr dmg]]",
      "Lurker:[(Bronya)[charge,knockback,stun,incr move]]",
      "Vanguard:[(Himeko)float]",
      "Test:[(Himeko)paralyze]",
    ];

    var Valks = [
    ];

    var Weapons = [
    ];

    function obj(elem)
    {
      // walk up parents until we fuind an obj
      let e = elem;
      while (e)
      {
        if (e.obj) return e.obj;
        e = e.parentElement;
      }
      return null;
    }

    class BaseUI
    {
      constructor(id)
      {
        this.id = id;

        this.lastHilite = -1;
        this.drawIndex = 0;
        this.divMode = "" + id;
        this.divSelect = "" + id;
        this.elemSearch = "" + id;
        this.elemResult = id + "";
        this.elemProp = id + "";
        this.name = "";
        this.root = null;
      }

      reset()
      {
        document.getElementById(this.divMode).innerHTML = "Select " + this.name + ": <input onmouseover='this.focus()' onmouseout='this.blur()' type=\"text\" id=\"" + this.elemSearch + "\" onchange=\"obj(this).search();\" onkeypress=\"this.onchange();\" onpaste=\"this.onchange();\" oninput=\"this.onchange();\" /><div id=\"" + this.divSelect + "\"></div>";
        this.lastHilite = -1;
        this.root = null;
        app.Set[this.id].Res.resolve(app.Set[this.id]);

        this.resetExtra();
      }

      resetExtra() { }

      getData() { return null; }

      search()
      {
        let query = document.getElementById(this.elemSearch).value.toLowerCase();
        let buf = "";
        if (query.length > 0)
        {
          let data = this.getData();
          for (let i in data)
          {
            if (data[i].name.toLowerCase().indexOf(query) != -1)
            {
              buf += "<div id='" + this.elemResult + i + "' onmouseover='obj(this).hilite(" + i + ")' onclick='obj(this).pick(" + i + ")'>" + data[i].name + "</div>";
            }
          }
        }
        document.getElementById(this.divSelect).innerHTML = buf;
      }

      hilite(index)
      {
        if (this.lastHilite > -1)
        {
          let item = document.getElementById(this.elemResult + this.lastHilite);
          if (item) item.style.border = "";//"2px solid rgba(0,0,0,0)";
        }
        this.lastHilite = index;
        let item = document.getElementById(this.elemResult + index);
        if (item) item.style.border = "2px solid green";
      }

      outline(index)
      {
        if (this.lastHilite > -1)
        {
          let item = document.getElementById(this.elemProp + this.lastHilite);
          if (item) item.style.border = "";//"2px solid rgba(0,0,0,0)";
        }
        this.lastHilite = index;
        let item = document.getElementById(this.elemProp + index);
        if (item) item.style.border = "2px solid black";
      }

      isSatisfied(item)
      {
        if (!item.if) return true;
        // check all my props to see if i am satisfied
        return app.Set[this.id].Res.has(item.if);
      }

      pick(index)
      {
        let data = this.getData();
        this.root = data[index];
        let buf = "Name: " + this.root.name + this.extraControls();
        buf += "<div id='" + this.divSelect + "Props'></div>";
        buf += "<br><button id='" + this.elemResult + "reset' onclick='obj(this).reset()'>Reset</button>";
        document.getElementById(this.divMode).innerHTML = buf;

        app.Set[this.id].Res.resolve(app.Set[this.id]);

        this.draw();
        this.resetExtra();

        if (this.root.name == "Vanguard")
        {
          app.pointAt(10, this.elemProp + "0", "This is a Himeko weapon.<br>Vanguard's properties appear here.");
          setTimeout(function () { app.pointAt(11, "0weapreset", "Reset this again.") }, 5000);
        }

        if (this.root.name == "Galactic Nova")
        {
          app.pointAt(6,this.elemProp + "0", "This is a Mei weapon, so its red.");
          setTimeout(function () { app.pointAt(7,"0weapreset", "Click 'Reset' to clear this pane.") }, 5000);
        }

        if (this.root.name == "Test")
        {
          app.pointAt(14, "0prop5", "With 'paralyze' available, Battle Storm's QTE becomes available.<br>THE END!");
          setTimeout(function () { document.getElementById("ftue").style.display = "none"; }, 10000);
        }

        if (this.root.name == "Battle Storm")
        {
          app.pointAt(2,this.elemProp + "14", "This is a list of her properties.<br>S rank is red because she is rank A.");
          setTimeout(function () { app.pointAt(3,"valkRankSelect0", "Drag the Rank slider to make her Rank S.") }, 5000);
        }
      }

      draw()
      {
        this.drawIndex = 0;
        document.getElementById(this.divSelect + "Props").innerHTML = this.drawProps(this.root);
      }

      drawProps(item)
      {
        let buf = "";
        let props = item.props;
        if (!Array.isArray(props)) props = [props];

        for (let i in props)
        {
          if (props[i].if)
          {
            // check if it is satisfied by our set of objects
            if (this.isSatisfied(props[i]))
            {
              // if so add its props
              buf += "<div class='met' id='" + this.elemProp + this.drawIndex + "' onclick='obj(this).query(" + this.drawIndex + ")' onmouseout='obj(this).outline(" + this.drawIndex + ")' onmouseover='obj(this).outline(" + this.drawIndex + ")'>" + props[i].if + "</div>";
              this.drawIndex += 1;
              buf += this.drawProps(props[i]);
            }
            else
            {
              // if not its red
              buf += "<div class='unmet' id='" + this.elemProp + this.drawIndex + "' onclick='obj(this).query(" + this.drawIndex + ")' onmouseout='obj(this).outline(" + this.drawIndex + ")' onmouseover='obj(this).outline(" + this.drawIndex + ")'>" + props[i].if + "</div>";
              this.drawIndex += 1;
            }
          }
          else
          {
            buf += "<div id='" + this.elemProp + this.drawIndex + "' onclick='obj(this).query(" + this.drawIndex + ")' onmouseout='obj(this).outline(" + this.drawIndex + ")' onmouseover='obj(this).outline(" + this.drawIndex + ")'>" + props[i] + "</div>";
            this.drawIndex += 1;
          }
        }
        return buf;
      }

      hookup()
      {
        document.getElementById(this.divMode).obj = this;
      }

      extraControls()
      {
        return "";
      }

      query(index)
      {
        let word = document.getElementById(this.elemProp + index).innerText;
        app.Set[this.id].query(word);
      }

      handleQuery(key)
      {
        let buf = "";
        if (key.length > 0)
        {
          let data = this.getData();
          for (let i in data)
          {
            if (this.hasProp(key,data[i]))
            {
              buf += "<div id='" + this.elemResult + i + "' onmouseover='obj(this).hilite(" + i + ")' onclick='obj(this).pick(" + i + ")'>" + data[i].name + "</div>";
            }
          }
        }
        document.getElementById(this.divSelect).innerHTML = buf;

        if (key == "Himeko")
        {
          app.pointAt(9, "0weap3", "Vanguard showed up. Click it.");
        }
        if (key == "paralyze")
        {
          app.pointAt(13, "0weap4", "A test weapon showed up. This weapon causes paralyzation. Click it.<br>I just added this for demonstrating.");
        }
      }

      hasProp(key, item)
      {
        let props = item.props;
        if (!Array.isArray(props)) props = [props];

        for (let i in props)
        {
          if (props[i].if)
          {
            if (props[i].if == key) return true;
            if (this.hasProp(key, props[i])) return true;
          }
          else if (props[i] == key) return true;
        }
        return false;
      }

    };

    class ValkUI extends BaseUI
    {
      constructor(id)
      {
        super(id);
        this.divMode = "valkMode" + id;
        this.divSelect = "valkSelect" + id;
        this.elemSearch = "valkSearch" + id;
        this.elemResult = id + "valk";
        this.elemProp = id + "prop";
        this.name = "Valkyrie";
        this.rank = "A";
        this.hookup();
      }

      resetExtra()
      {
        if (app.Set[this.id].Weap.root)
        {
          app.Set[this.id].Weap.draw();
        }
      }

      getData() { return Valks; }

      setrank()
      {
        let elem = document.getElementById("valkRankSelect" + this.id);
        if (elem)
        {
          switch (elem.value|0)
          {
            case 1: this.rank = "B"; break;
            case 2: this.rank = "A"; break;
            case 3: {
              this.rank = "S"; app.pointAt(4,this.elemProp + "14", "Now she is S Rank! More properties appear.");
              setTimeout(function () { app.pointAt(5,app.Set[0].Weap.elemSearch, "Now lets search for 'Galactic Nova'!") },5000);
              break;
            }
            case 4: this.rank = "SS"; break;
            case 5: this.rank = "SSS"; break;
          }

          app.Set[this.id].Res.resolve(app.Set[this.id]);

          this.draw();
          this.resetExtra();
          document.getElementById("valkRank" + this.id).innerHTML = "<b>" + this.rank + "</b>";
        }
      }

      extraControls()
      {
        return "<br>Rank: <span id=\"valkRank" + this.id + "\"><b>A</b></span> <input class='slider' oninput = 'obj(this).setrank()' type=\"range\" min=\"1\" max=\"5\" value=\"2\" id=\"valkRankSelect" + this.id + "\"><br><br>";
      }
    };

    class WeapUI extends BaseUI
    {
      constructor(id)
      {
        super(id);
        this.divMode = "weapMode" + id;
        this.divSelect = "weapSelect" + id;
        this.elemSearch = "weapSearch" + id;
        this.elemResult = id + "weap";
        this.elemProp = id + "wprop";
        this.name = "Weapon";
        this.hookup();
      }

      getData() { return Weapons; }

      resetExtra()
      {
        if (app.Set[this.id].Valk.root)
        {
          app.Set[this.id].Valk.draw();
        }

        if (document.getElementById(app.Set[0].Valk.elemProp + "1"))
          app.pointAt(8,app.Set[0].Valk.elemProp + "1", "Now click on Himeko's name to search for her weapons.");

        app.pointAt(12, "0prop5", "Battle Storm can make use of the paralyze skill.<br>It is red because nothing is providing the paralyze skill<br>Lets search for something. Click 'paralyze'");

      }
    };

    class Set
    {
      Valk = null;
      Weap = null;
      Res = null;

      constructor(id)
      {
        this.Valk = new ValkUI(id);
        this.Weap = new WeapUI(id);
        this.Res = new Resolver();
      }

      reset()
      {
        this.Valk.reset();
        this.Weap.reset();
      }

      query(key)
      {
        if (this.Valk.root == null) this.Valk.handleQuery(key);
        if (this.Weap.root == null) this.Weap.handleQuery(key);
      }
    };

    ftuestep = 1;

    class App
    {
      Set = [];
      constructor()
      {
        this.Set[0] = new Set(0);
        this.Set[1] = new Set(1);
        this.Set[2] = new Set(2);

        for (let i in dataValks) Valks.push(parseObject(dataValks[i]));
        for (let i in dataWeapons) Weapons.push(parseObject(dataWeapons[i]));
      }

      stopTutorial()
      {
        ftuestep = 99;
        document.getElementById("ftue").style.display = "none";
      }

      pointAt(step,name,text)
      {
        if (step != ftuestep) return;
        ftuestep += 1;
        let elem = document.getElementById(name).getBoundingClientRect();
        let ftue = document.getElementById("ftue");
        ftue.style.position = "absolute";
        ftue.style.left = elem.right + 'px';
        ftue.style.top = elem.top + 'px';
        ftue.innerHTML = text;
      }

      reset()
      {
        for (let i in this.Set) this.Set[i].reset();
      }
    };

    class Resolver
    {
      props = {};
      ifs = [];

      constructor()
      {
      }

      has(key) { return (this.props[key] != null); }

      resolve(set)
      {
        this.props = {};
        this.ifs = [];
        if (set.Valk.root)
        {
          // special case - valk rank
          if (set.Valk.rank == "B")   { this.props["B"] = "B"; }
          if (set.Valk.rank == "A")   { this.props["B"] = "B"; this.props["A"] = "A";  }
          if (set.Valk.rank == "S")   { this.props["B"] = "B"; this.props["A"] = "A"; this.props["S"] = "S";  }
          if (set.Valk.rank == "SS")  { this.props["B"] = "B"; this.props["A"] = "A"; this.props["S"] = "S"; this.props["SS"] = "SS"; }
          if (set.Valk.rank == "SSS") { this.props["B"] = "B"; this.props["A"] = "A"; this.props["S"] = "S"; this.props["SS"] = "SS"; this.props["SSS"] = "SSS";}
          this.processItem(set.Valk.root);
        }
        if (set.Weap.root) this.processItem(set.Weap.root);
        while (this.processIf()) { }
      }

      processItem(obj)
      {
        for (let i in obj.props) this.processProp(obj.props[i]);
      }

      processProp(item)
      {
        let props = item.props;
        if (!Array.isArray(props)) props = [props];

        for (let i in props)
        {
          if (props[i].if)
          {
            this.ifs.push(props[i]);
          }
          else
          {
            this.props[props[i]] = props[i];
          }
        }
      }

      processIf()
      {
        let ret = false;
        for (let i in this.ifs)
        {
          if (!this.ifs[i]) continue;
          if (this.props[this.ifs[i].if])
          {
            this.processProp(this.ifs[i]);
            this.ifs[i] = null;
            ret = true;
          }
        }
        return ret;
      }
    };

    var app = null;

    function init()
    {
      app = new App();
      app.reset();
      app.pointAt(1,app.Set[0].Valk.elemSearch, "Try searching for 'Battle Storm'<br>Click her name when it appears.");

    }

    function parseObject(data)
    {
      // data := key ":" props
      // props := "[" item ("," item) "]"
      // item := (if) props
      // if := "(" key ")"

      // get the name
      let loc = data.indexOf(':');
      if (loc == -1) return null;
      let name = data.substr(0, loc);
      let props = data.substr(loc + 1);
      // make item
      let item = { name: name, props: parseProps(props) };
      return item;
    }

    function parseProps(data)
    {
      let ret = [];
      do
      {
        // start with [, end with ]
        if (data[0] != '[') break;
        if (data[data.length - 1] != ']') break;
        // split into seperate terms
        let inside = 0;
        let start = 1;
        for (let x = start; x < data.length - 1; ++x)
        {
          switch (data[x])
          {
            case '[': inside++; break;
            case ']': inside--; break;
            case ',': if (!inside) { ret.push(parseItem(data.substr(start, x - start))); start = x + 1; break; }
          }
        }
        if (start < data.length - 1) ret.push(parseItem(data.substr(start, data.length - start - 1)));
      } while (false);
      return ret;
    }

    function parseItem(data)
    {
      // check for if
      if (data[0] == '(')
      {

        let loc = data.indexOf(')');
        let ifkey = data.substr(1, loc - 1);
        if (data[loc + 1] == '[')
          return { if: ifkey, code: 1, props: parseProps(data.substr(loc + 1)) };
        else
          return { if: ifkey, code: 1, props: parseItem(data.substr(loc + 1)) };
      }
      // its just a key
      else
      {
        return data;
      }
    }

    animImage = new Image();
    animImage.src = "frontpage/animatedlogo.gif";
    staticImage = new Image();
    staticImage.src = "frontpage/logo.jpg";
  </script>
</head>

<body onload="init();">
  <div class="header">
    <a href='#1' onmouseover="logo.src=animImage.src;" onmouseout="logo.src=staticImage.src;"><img name="logo" src="frontpage/logo.jpg" /></a>
  </div>
  <div class="menu">
    HONKAI IMPACT TOOL<br /><br />
    <button onclick="app.stopTutorial();">Skip Tutorial</button>
  </div>
  <div style="position: absolute; top:130px">
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 1</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode0"></div>
        </td>
        <td valign="top">
          <div><b>Weapon</b></div>
          <div id="weapMode0"></div>
        </td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>
  <br />
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 2</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode1"></div>
        </td>
        <td valign="top">
          <div><b>Weapon</b></div>
          <div id="weapMode1"></div>
        </td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>
  <br />
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 3</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode2"></div>
        </td>
        <td valign="top">
          <div><b>Weapon</b></div>
          <div id="weapMode2"></div>
        </td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>
  </div>
  <div  class="my-tooltip left-top" id="ftue">This is some help text</div>
</body>
</html>
