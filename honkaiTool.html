
<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <title>Madox Labs - Honkai Impact Tool</title>

  <style>
    div.unmet {
      background-color: #aa0000;
      color: #ffffff;
    }

    div.met {
      background-color: #00aa00;
      color: #ffffff;
    }

    table.blueTable {
      border: 1px solid #1C6EA4;
      background-color: #EEEEEE;
      width: 100%;
      text-align: left;
      border-collapse: collapse;
    }

      table.blueTable td, table.blueTable th {
        border: 1px solid #AAAAAA;
        padding: 3px 2px;
      }

      table.blueTable tbody td {
        font-size: 13px;
      }

      table.blueTable tr:nth-child(even) {
        background: #D0E4F5;
      }

      table.blueTable thead {
        background: #1C6EA4;
        background: -moz-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        background: -webkit-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        background: linear-gradient(to bottom, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        border-bottom: 2px solid #444444;
      }

        table.blueTable thead th {
          font-size: 15px;
          font-weight: bold;
          color: #FFFFFF;
          border-left: 2px solid #D0E4F5;
        }

          table.blueTable thead th:first-child {
            border-left: none;
          }

      table.blueTable tfoot td {
        font-size: 14px;
      }

      table.blueTable tfoot .links {
        text-align: right;
      }

        table.blueTable tfoot .links a {
          display: inline-block;
          background: #1C6EA4;
          color: #FFFFFF;
          padding: 2px 8px;
          border-radius: 5px;
        }

    .slider {
      -webkit-appearance: none;
      height: 15px;
      background: #d3d3d3;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }

      .slider:hover {
        opacity: 1;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 15px;
        height: 15px;
        background: #4CAF50;
        cursor: pointer;
      }

      .slider::-moz-range-thumb {
        width: 15px;
        height: 15px;
        background: #4CAF50;
        cursor: pointer;
      }
  </style>

  <script type="text/javascript">

    /*
    BATTLE STORM
    B aoe knockdown (paralyze)[QTE, knockback] (crit)[fire] gather float fire charge weaken fracture slow
    S stun
    SS ignite
    SSS stun

    KRIEGSMESSER
    A charge ice slow aoe knockdown (ignite)[QTE ice freeze] freeze
    S ice
    SSS slow

    SCARLET FUSION
    A charge float lightning paralyze
    S (fracture)[QTE float lightning paralyze AOE] paralyze AOE (ignite) (bleed)
    SS bleed
    SSS paralyze

    VALKYRIE TRIUMPH
    A fracture aoe charge stun (frozen) (stun) (leader)[BIO]
    S (frozen)[QTE] heal


    */

    var dataValks = [
      "Battle Storm:[(B)[Himeko,BIO,aoe,knockdown,(paralyze)[QTE,knockback],(crit)[],gather,float,fire,charge,weaken,fracture,slow],(S)stun,(SS)ignite]",
      "Kreigsmesser:[(A)[Himeko,PSY,charge,ice,slow,aoe,knockdown,(ignite)[QTE],freeze],(SSS)slow]",
      "Scarlet Fusion:[(A)[Himeko,MECH,charge,float,lightning,paralyze],(S)[(fracture)[QTE],aoe,(ignite)[],(bleed)[]],(SS)bleed]",
      "Valkyrie Triumph:[(A)[Himeko,BIO,fracture,aoe,charge,stun,(frozen),(stun),(leader)[BIO]],(S)[(frozen)[QTE],heal]]",
      "Herrscher Of The Void:[]",
      "Shadow Dash:[]",
      "Valkyrie Ranger:[]",
      "Sundenjager:[]",
      "Valkyrie Chariot:[]",
      "Dimension Breaker:[]",
      "Night Squire:[]",
      "White Comet:[]",
      "Ritual Imayoh:[]",
      "Divine Prayer:[]",
      "Crimson Impulse:[]",
      "Gyakushinn Miko:[]",
      "Valkyrie Triumph:[]",
      "Scarlet Fusion:[]",
      "Valkyrie Pledge:[]",
      "Luna Kindred:[]"
    ];

    var dataWeapons = [
      "Galactic Nova:[(Mei)[incr crit,incr dmg,sparkling star,aoe]]",
      "Jizo Mitama:[(Mei)[summon,float,(float)incr dmg,(coop)incr dmg]]",
      "Lurker:[(Bronya)[charge,knockback,stun,incr move]]",
      "Vanguard:[(Himeko)float]"
    ];

    var Valks = [
    ];

    var Weapons = [
    ];

    function obj(elem)
    {
      // walk up parents until we fuind an obj
      let e = elem;
      while (e)
      {
        if (e.obj) return e.obj;
        e = e.parentElement;
      }
      return null;
    }

    class BaseUI
    {
      constructor(id)
      {
        this.id = id;

        this.lastHilite = -1;
        this.drawIndex = 0;
        this.divMode = "" + id;
        this.divSelect = "" + id;
        this.elemSearch = "" + id;
        this.elemResult = id + "";
        this.elemProp = id + "";
        this.name = "";
        this.root = null;
      }

      reset()
      {
        document.getElementById(this.divMode).innerHTML = "Select " + this.name + ": <input onmouseover='this.focus()' onmouseout='this.blur()' type=\"text\" id=\"" + this.elemSearch + "\" onchange=\"obj(this).search();\" onkeypress=\"this.onchange();\" onpaste=\"this.onchange();\" oninput=\"this.onchange();\" /><div id=\"" + this.divSelect + "\"></div>";
        this.lastHilite = -1;
      }

      getData() { return null; }

      search()
      {
        let query = document.getElementById(this.elemSearch).value.toLowerCase();
        let buf = "";
        if (query.length > 0)
        {
          let data = this.getData();
          for (let i in data)
          {
            if (data[i].name.toLowerCase().indexOf(query) != -1)
            {
              buf += "<div id='" + this.elemResult + i + "' onmouseover='obj(this).hilite(" + i + ")' onclick='obj(this).pick(" + i + ")'>" + data[i].name + "</div>";
            }
          }
        }
        document.getElementById(this.divSelect).innerHTML = buf;
      }

      hilite(index)
      {
        if (this.lastHilite > -1)
        {
          let item = document.getElementById(this.elemResult + this.lastHilite);
          if (item) item.style.border = "";//"2px solid rgba(0,0,0,0)";
        }
        this.lastHilite = index;
        let item = document.getElementById(this.elemResult + index);
        if (item) item.style.border = "2px solid green";
      }

      outline(index)
      {
        if (this.lastHilite > -1)
        {
          let item = document.getElementById(this.elemProp + this.lastHilite);
          if (item) item.style.border = "";//"2px solid rgba(0,0,0,0)";
        }
        this.lastHilite = index;
        let item = document.getElementById(this.elemProp + index);
        if (item) item.style.border = "2px solid black";
      }

      isSatisfied(item)
      {
        if (!item.if) return true;
        if (item.if == "leader" && this.id == 0) return true;
        return this.isSatisfiedExtra(item);
      }

      isSatisfiedExtra(item)
      {
        return false;
      }

      pick(index)
      {
        let data = this.getData();
        this.root = data[index];
        let buf = "Name: " + this.root.name + this.extraControls();
        buf += "<div id='" + this.divSelect + "Props'></div>";
        buf += "<br><button onclick='obj(this).reset()'>Reset</button>";
        document.getElementById(this.divMode).innerHTML = buf;

        this.draw();
      }

      draw()
      {
        this.drawIndex = 0;
        document.getElementById(this.divSelect + "Props").innerHTML = this.drawProps(this.root);
      }

      drawProps(item)
      {
        let buf = "";
        let props = item.props;
        if (!Array.isArray(props)) props = [props];

        for (let i in props)
        {
          if (props[i].if)
          {
            // check if it is satisfied by our set of objects
            if (this.isSatisfied(props[i]))
            {
              // if so add its props
              buf += "<div class='met' id='" + this.elemProp + this.drawIndex + "' onmouseout='obj(this).outline(" + this.drawIndex + ")' onmouseover='obj(this).outline(" + this.drawIndex + ")'>" + props[i].if + "</div>";
              this.drawIndex += 1;
              buf += this.drawProps(props[i]);
            }
            else
            {
              // if not its red
              buf += "<div class='unmet' id='" + this.elemProp + this.drawIndex + "' onmouseout='obj(this).outline(" + this.drawIndex + ")' onmouseover='obj(this).outline(" + this.drawIndex + ")'>" + props[i].if + "</div>";
              this.drawIndex += 1;
            }
          }
          else
          {
            buf += "<div id='" + this.elemProp + this.drawIndex + "' onmouseout='obj(this).outline(" + this.drawIndex + ")' onmouseover='obj(this).outline(" + this.drawIndex + ")'>" + props[i] + "</div>";
            this.drawIndex += 1;
          }
        }
        return buf;
      }

      hookup()
      {
        document.getElementById(this.divMode).obj = this;
      }

      extraControls()
      {
        return "";
      }
    };

    class ValkUI extends BaseUI
    {
      constructor(id)
      {
        super(id);
        this.divMode = "valkMode" + id;
        this.divSelect = "valkSelect" + id;
        this.elemSearch = "valkSearch" + id;
        this.elemResult = id + "valk";
        this.elemProp = id + "prop";
        this.name = "Valkyrie";
        this.rank = "A";
        this.rankNum = 1;
        this.hookup();
      }

      isSatisfiedExtra(item)
      {
        if (item.if == "B" && this.rankNum >= 1) return true;
        if (item.if == "A" && this.rankNum >= 2) return true;
        if (item.if == "S" && this.rankNum >= 3) return true;
        if (item.if == "SS" && this.rankNum >= 4) return true;
        if (item.if == "SSS" && this.rankNum == 5) return true;
        return false;
      }

      getData() { return Valks; }

      setrank()
      {        
        let elem = document.getElementById("valkRankSelect" + this.id);
        if (elem)
        {
          this.rankNum = elem.value | 0;
          switch (elem.value|0)
          {
            case 1: this.rank = "B"; break;
            case 2: this.rank = "A"; break;
            case 3: this.rank = "S"; break;
            case 4: this.rank = "SS"; break;
            case 5: this.rank = "SSS"; break;
          }
          this.draw();
          document.getElementById("valkRank" + this.id).innerHTML = "<b>"+this.rank+"</b>";
        }
      }

      extraControls()
      {
        return "<br>Rank: <span id=\"valkRank" + this.id + "\"><b>A</b></span> <input class='slider' oninput = 'obj(this).setrank()' type=\"range\" min=\"1\" max=\"5\" value=\"2\" id=\"valkRankSelect" + this.id + "\"><br><br>";
      }
    };

    class WeapUI extends BaseUI
    {
      constructor(id)
      {
        super(id);
        this.divMode = "weapMode" + id;
        this.divSelect = "weapSelect" + id;
        this.elemSearch = "weapSearch" + id;
        this.elemResult = id + "weap";
        this.elemProp = id + "wprop";
        this.name = "Weapon";
        this.hookup();
      }

      getData() { return Weapons; }
    };

    class App
    {
      Valk = [];
      Weap = [];
      constructor()
      {
        this.Valk[0] = new ValkUI(0);
        this.Valk[1] = new ValkUI(1);
        this.Valk[2] = new ValkUI(2);
        this.Weap[0] = new WeapUI(0);
        this.Weap[1] = new WeapUI(1);
        this.Weap[2] = new WeapUI(2);

        for (let i in dataValks) Valks.push(parseObject(dataValks[i]));
        for (let i in dataWeapons) Weapons.push(parseObject(dataWeapons[i]));
      }

      reset()
      {
        for (let i in this.Valk) this.Valk[i].reset();
        for (let i in this.Weap) this.Weap[i].reset();
      }
    }

    var app = null;

    function init()
    {
      app = new App();
      app.reset();
    }

    function parseObject(data)
    {
      // data := key ":" props
      // props := "[" item ("," item) "]"
      // item := (if) props
      // if := "(" key ")"

      // get the name
      let loc = data.indexOf(':');
      if (loc == -1) return null;
      let name = data.substr(0, loc);
      let props = data.substr(loc + 1);
      // make item
      let item = { name: name, props: parseProps(props) };
      return item;
    }

    function parseProps(data)
    {
      let ret = [];
      do
      {
        // start with [, end with ]
        if (data[0] != '[') break;
        if (data[data.length - 1] != ']') break;
        // split into seperate terms
        let inside = 0;
        let start = 1;
        for (let x = start; x < data.length - 1; ++x)
        {
          switch (data[x])
          {
            case '[': inside++; break;
            case ']': inside--; break;
            case ',': if (!inside) { ret.push(parseItem(data.substr(start, x - start))); start = x + 1; break; }
          }
        }
        if (start < data.length - 1) ret.push(parseItem(data.substr(start, data.length - start - 1)));
      } while (false);
      return ret;
    }

    function parseItem(data)
    {
      // check for if
      if (data[0] == '(')
      {

        let loc = data.indexOf(')');
        let ifkey = data.substr(1, loc - 1);
        if (data[loc + 1] == '[')
          return { if: ifkey, props: parseProps(data.substr(loc + 1)) };
        else
          return { if: ifkey, props: parseItem(data.substr(loc + 1)) };
      }
      // its just a key
      else
      {
        return data;
      }
    }
  </script>
</head>

<body onload="init();">
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 1</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode0"></div>
        </td>
        <td valign="top">
          <div><b>Weapon</b></div>
          <div id="weapMode0"></div>
        </td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>
  <br />
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 2</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode1"></div>
        </td>
        <td valign="top">
          <div><b>Weapon</b></div>
          <div id="weapMode1"></div>
        </td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>
  <br />
  <table class="blueTable">
    <thead><tr><td colspan="5">VALKYRIE 3</td></tr></thead>
    <tbody>
      <tr>
        <td width="300px">
          <div><b>Valkyrie</b></div>
          <div id="valkMode2"></div>
        </td>
        <td valign="top">
          <div><b>Weapon</b></div>
          <div id="weapMode2"></div>
        </td>
        <td valign="top"><div><b>T Stigmata</b></div></td>
        <td valign="top"><div><b>M Stigmata</b></div></td>
        <td valign="top"><div><b>B Stigmata</b></div></td>
      </tr>
    </tbody>
  </table>

</body>
</html>
