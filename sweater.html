<html>
<head>
  <style>
    body {
      background: #000;
    }

    table {
      border-collapse: collapse;
      table-layout: fixed;
      width: 600px;
      border: 2px solid #006699; 
      -webkit-border-radius: 3px; 
      -moz-border-radius: 3px; 
      border-radius: 3px;
    }
    th {
      background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #118FCF), color-stop(1, #00486B) );
      background:-moz-linear-gradient( center top, #118FCF 5%, #00486B 100% );
      filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#118FCF', endColorstr='#00486B');
      background-color:#118FCF; 
      color:#19FF30; 
      font-size: 20px; 
      font-weight: bold; 
      text-align:left;
    }
    td {
      width: 300px;
      vertical-align:top;
      color: #C4D61C;
      border-left: 3px solid #00486B;
      background: #000;
    }
    button {
      -moz-border-radius: 23px;
      -moz-box-shadow: #6E7849 0px 0px 10px;
      -moz-transition: all 0.5s ease;
      -ms-transition: all 0.5s ease;
      -o-transition: all 0.5s ease;
      -webkit-border-radius: 23px;
      -webkit-box-shadow: #6E7849 0 0 10px;
      -webkit-transition: all 0.5s ease;
      background-color: Transparent;
      border-radius: 23px;
      border: 4px solid #29a81f;
      box-shadow: #6E7849 0px 0px 10px;
      color: #10db0a;
      display: inline-block;
      margin: auto;
      padding-top: 4px;
      padding-right: 9px;
      padding-bottom: 4px;
      padding-left: 9px;
      text-decoration: none;
      text-shadow: #6E7849 5px 5px 15px;
      transition: all 0.5s ease;
    }
    button:hover {
      border: 4px solid #ebec13;
    }
  </style>
  <script>
    var State = {};
    var Rooms = {};
    var Objects = {};
    var Self = {};

    function Room(id, name, text)
    {
      this.id = id;
      this.name = name;
      this.alttext = {};
      this.dir = {};
      this.text = text;
      this.object = [];

      Rooms[id] = this;
    }

    Room.prototype.addAlt = function (text, key)
    {
      this.alttext[key] = text;
    };

    Room.prototype.addDirection = function (dir, id)
    {
      this.dir[dir] = id;
    };

    Room.prototype.addObject = function (obj)
    {
      Objects[obj.id] = obj;
      this.object.push(obj.id);
    };

    function Thing(id, req, text)
    {
      this.id = id;
      this.require = req;
      this.text = text;
      this.alttext = {};
      this.choice = [];
      this.action = {};
      this.curaction = 0;
    }

    Thing.prototype.addAlt = function (text, key)
    {
      this.alttext[key] = text;
    };

    Thing.prototype.addChoice = function (text, id)
    {
      this.choice.push({ id: id, text: text });
    };

    Thing.prototype.addAction = function (obj)
    {
      this.action[obj.id] = obj;
    };

    function Action(id, req, set, text)
    {
      this.id = id;
      this.require = req;
      this.text = text;
      this.setState = set;
      this.choice = [];
      this.goto = 0;
    }

    Action.prototype.addChoice = function (text, id)
    {
      this.choice.push({ id: id, text: text });
    };

    function move(i)
    {
      State.room = i;
      for (var i in Objects) Objects[i].curaction = 0;
      document.getElementById("actiontext").innerHTML = "";
      document.getElementById("objects").innerHTML = "Nothing";
      document.getElementById("actions").innerHTML = "None";
      process();
    }

    function checkReqs(obj)
    {
      if (obj.require == "") return true;

      var checks = obj.require ? obj.require.split(" ") : obj.split(" ");
      for (var i in checks)
      {
        var member = checks[i];
        if (member[0] == '!')
        {
          member = member.substr(1);
          if ((member in State) == true) return false;
        }
        else
        {
          if ((member in State) == false) return false;
        }
      }
      return true;
    }

    function perform(room, objectid, actionid)
    {
      var obj = Objects[objectid];
      var action = obj.action[actionid];

      if (action.setState.length > 0)
      {
        var add = action.setState.split(" ");
        for (var i in add) if (add[i][0] == '!') delete State[add[i].substr(1)]; else State[add[i]] = true;
      }
      if (Object.keys(action.choice).length > 0) obj.curaction = actionid;
      else obj.curaction = 0;

      if (action.goto) obj.curaction = action.goto;
      process();
      document.getElementById("actiontext").innerHTML = action.text;
    }

    function getText(obj)
    {
      var desc = obj.text;
      for (var i in obj.alttext)
      {
        if (checkReqs(i) == false) continue;
        desc += " " + obj.alttext[i];
      }
      return desc;
    }

    function getSelfText()
    {
      var desc = "";
      for (var i in Self)
      {
        if (checkReqs(i) == false) continue;
        desc += " " + Self[i];
      }
      return desc;
    }

    function process()
    {
      var room = Rooms[State.room];
      document.getElementById("title").innerText = room.name;
      document.getElementById("text").innerHTML = getText(room) + "<br>" + getSelfText();

      var objs = "";
      var choices = "";

      for (var i in room.object)
      {
        var obj = Objects[room.object[i]];
        if (checkReqs(obj) == false) continue;
        if (objs.length > 0) objs += "<br>";
        objs += getText(obj);

        var choice = obj;
        if (obj.curaction) choice = obj.action[obj.curaction];
        choice = choice.choice;
        for (var i in choice)
        {
          var action = obj.action[choice[i].id];
          if (checkReqs(action) == false) continue;
          choices += "<button onclick='perform(" + room.id + "," + obj.id + "," + action.id + ");'>" + choice[i].text + "</button><br>";
        }

      }
      if (objs.length) document.getElementById("objects").innerHTML = objs;
      if (choices.length) document.getElementById("actions").innerHTML = choices;

      var dir = "";
      for (var i in room.dir)
        dir += "<button onclick='move(" + room.dir[i] + ");'>"+i+"</button>";
      document.getElementById("directions").innerHTML = dir;
    }

  </script>
  <script>
    var room;
    room = new Room(1, "Santa's Sweater! Introduction", "Welcome to Santa's Sweater, a text adventure game.<br>You are one of Santa's little helpers living in Santa's Village. Santa has called you to the Workshop because he has a very important mission for you! Click Start to begin!");
    room.addDirection("Start", 2);

    room = new Room(2, "Santa's Workshop", "Santa's helpers are busy running here and there, assembling toys for boys and girls. Noisy machines and conveyor belts are everywhere.")
    room.addDirection("Leave Workshop", 3);

    room = new Room(3, "Main St West", "This end of Main St is awash in green and red holiday lights. The street is a lovely boulevard for strolling along. Santa's Workshop is here at the end of the street, and a souviner shop is on the north side.");
    room.addDirection("Enter Workshop", 2);
    room.addDirection("Enter Store", 18);
    room.addDirection("East", 4);

    room = new Room(4, "Main Intersection", "This moderately busy intersection is where Main and Dasher streets meet. A lot of Santa's helpers live in the well-to-do north end of Dasher St, but south Dasher also has a few nice neighbourhoods.");
    room.addDirection("North", 9);
    room.addDirection("South", 7);
    room.addDirection("East", 5);
    room.addDirection("West", 3);

    room = new Room(5, "Main St East", "Main St is a continuous line of shops and restarants, all bustling with holiday activity. Various side streets connect the residential areas to Main St along the way.");
    room.addDirection("North", 17);
    room.addDirection("East", 6);
    room.addDirection("West", 4);

    room = new Room(6, "End of Main St ", "Far past the shops and merrymakers, the end of Main St is gloomy and desolated. A fenced in vacant lot here looks long abandoned and has becoming a dumping ground.");
    room.addDirection("West", 5);

    room = new Room(7, "Dasher Ave N", "Holly's house is here. Describe house. An alleyway between houses is to the east. Dancer St is to the west.");
    room.addDirection("North", 4);
    room.addDirection("South", 8);
    room.addDirection("East", 11);
    room.addDirection("West", 13);

    room = new Room(8, "Dasher Ave S", "Merry's house is here. Describe house.");
    room.addDirection("North", 7);

    room = new Room(9, "Donner Ave S", "Jolly's house is here. Describe house. Blitzen St crosses Donner St here.");
    room.addDirection("North", 10);
    room.addDirection("South", 4);
    room.addDirection("East", 17);
    room.addDirection("West", 16);

    room = new Room(10, "Donner Ave N", "Bob's house is here. Describe house. Comet St crosses Donner St here.");
    room.addDirection("South", 9);
    room.addDirection("East", 15);
    room.addDirection("West", 14);

    room = new Room(11, "Alley", "The alleyway is dimly lit, but clean enough. A couple Ladys of the Night leaning up against one wall watching you eagery. The east end of the alley ends at a brick wall with a door set in it.");
    room.addDirection("East", 12);
    room.addDirection("West", 7);

    room = new Room(12, "Brick Wall", "You are standing in front of a plain brick wall with a steel door set into it.")
    room.addDirection("West", 11);

    room = new Room(13, "Dancer Lane", "Jingle's house is here. Describe house.")
    room.addDirection("East", 7);

    room = new Room(14, "W Comet St", "Snowbell's house is here. Describe house. The end of Comet St heads south to Blitzen St.")
    room.addDirection("South", 16);
    room.addDirection("East", 10);

    room = new Room(15, "E Comet St", "John's house is here. Describe house. The end of Comet St heads south to Blitzen St.");
    room.addDirection("South", 17);
    room.addDirection("West", 10);

    room = new Room(16, "W Blitzen St", "Chime's house is here. Describe house. The end of Blitzen St heads north to Comet St.");
    room.addDirection("North", 14);
    room.addDirection("East", 9);

    room = new Room(17, "E Blitzen St", "Flitter's house is here. Describe house. The end of Blitzen St heads north to Comet St and also back to Main St.");
    room.addDirection("North", 15);
    room.addDirection("South", 5);
    room.addDirection("West", 9);

    room = new Room(18, "Store", "This store is packed to the rafters with shelves of all sorts of knickknacks and other useless tourist junk. THe proprieter behind the counter is busy reading the newspaper.")
    room.addDirection("Leave", 3);

    //--------------------------- SANTA
    obj = new Thing(100, "", "Santa Claus");
    obj.addChoice("Talk to Santa", 500);

    var a500 = new Action(500, "", "", "What do you say?");
    a500.addChoice("Hi Santa!", 501);
    a500.addChoice("You wanted to see me?", 502);
    a500.addChoice("Yo, big man!", 504);
    a500.addChoice("Hi Santa!", 505);
    a500.addChoice("You wanted to see me?", 506);
    a500.addChoice("Hi Santa!", 507);
    a500.addChoice("You wanted to see me?", 508);
    a500.addChoice("How may I be of assistance, Mr. Claus?", 509);
    a500.addChoice("Lovely weather we're having.", 510);
    a500.addChoice("How are you doing today?", 511);
    a500.addChoice("Aren't you looking marvelous!", 512);
    a500.addChoice("Nevermind", 503);
    obj.addAction(a500);

    obj.addAction(new Action(503, "", "", ""));

    var a501 = new Action(501, "!santa-annoy !santa-mad", "santa-ok", "Well, hello there little fella! Have you been a good helper this year?");
    a501.addChoice("Of course!", 513);
    a501.addChoice("Not really.", 514);
    a501.addChoice("I don't know.", 515);
    obj.addAction(a501);
    var a513 = new Action(513, "santa-ok", "", "Really? Remember I know all about you.");
    a513.addChoice("Well, I shaved my neighbour's cat once.", 515);
    a513.addChoice("Well, I put laxatives in the eggnog once", 515);
    a513.addChoice("Well, I made rude snowmen in front of the school", 515);
    obj.addAction(a513);
    var a514 = new Action(514, "santa-ok", "", "I thought so. How bad were you?");
    a514.goto = 513;
    obj.addAction(a514);
    var a515 = new Action(515, "santa-ok", "", "Well that's an honest answer. I have a job for you.");
    a515.addChoice("Of course!", 600);
    obj.addAction(a515);

    var a502 = new Action(502, "!santa-annoy !santa-mad", "santa-annoy", "All business then, eh? Can't even exchange pleasentries?");
    a502.goto = 500;
    obj.addAction(a502);
    var a510 = new Action(510, "!santa-mad santa-annoy", "", "I wouldn't know. I've been cooped up in here all day.");
    a510.goto = 500;
    obj.addAction(a510);
    var a511 = new Action(511, "!santa-mad santa-annoy", "", "Lousy. I've been cooped up in here all day.");
    a511.goto = 500;
    obj.addAction(a511);
    var a512 = new Action(512, "!santa-mad santa-annoy", "!santa-annoy", "Do you really think so?");
    a512.addChoice("Of course!", 600);
    a512.addChoice("Not really.", 504);
    obj.addAction(a512);

    var a504 = new Action(504, "!santa-annoy !santa-mad", "santa-mad santa-mad1", "You impertenant rapscallion! I will not be addressed in this manner. Try again.");
    a504.goto = 500;
    obj.addAction(a504);
    var a505 = new Action(505, "santa-mad1", "!santa-mad1 santa-mad2a", "Not good enough, sonny.");
    a505.goto = 500;
    obj.addAction(a505);
    var a506 = new Action(506, "santa-mad1", "!santa-mad1 santa-mad2b", "Not good enough, sonny.");
    a506.goto = 500;
    obj.addAction(a506);
    var a507 = new Action(507, "santa-mad2b", "!santa-mad2b santa-mad3", "I said not good enough!");
    a507.goto = 500;
    obj.addAction(a507);
    var a508 = new Action(508, "santa-mad2a", "!santa-mad2a santa-mad3", "I said not good enough!");
    a508.goto = 500;
    obj.addAction(a508);
    var a509 = new Action(509, "santa-mad3", "!santa-mad3", "That will have to do. I have a job for you. Think you can do it?");
    a509.addChoice("I'll do my best, sir!", 600);
    obj.addAction(a509);

    var a600 = new Action(600, "", "start", "I need you to find my sweater and bring it to me. It's getting cold in here.");
    a600.addChoice("I'm on it!", 503);
    obj.addAction(a600);

    Rooms[2].addObject(obj);

  </script>

</head>
<body onload="move(1);">
  <table>
    <tr>
      <th colspan="2"><span id="title"></span> - <span id="directions"></span></th>
    </tr>
    <tr>
      <td><span id="text"></span></td>
      <td><span id="actiontext"></span></td>
    </tr>
    <tr>
      <th>What's Here</th>
      <th>Actions</th>
    </tr>
    <tr>
      <td><span id="objects"></span></td>
      <td><span id="actions"></span></td>
    </tr>
  </table>

</body>
</html>
